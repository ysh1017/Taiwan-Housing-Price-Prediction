# Taiwan-Housing-Prediction

---
本專案透過數據分析與特徵工程，特別著重空間地理資訊處理，包括經緯度數據採集與KMeans空間聚類。研究過程中發現「單價元平方公尺」與「建物移轉總面積平方公尺」的乘積具有極高解釋力，適當情境下可將MAE降至約5000。同時透過時間特徵處理、樓層資訊數值化以及XGBoost模型訓練，最終建立高精度的房價預測系統。未來將進一步引入房價指數與更細緻的地段資訊，持續優化預測表現。

## 研究過程

### 1. 閱讀相關資料並找尋想法
#### **價格分佈狀況**
資料呈現明顯的右偏分佈，大多數房價集中在相對較低的區間，只有少數高價物件拉長了整體分佈的尾端。

![價格分佈](https://github.com/user-attachments/assets/eaf441e4-6ef4-49a4-aae3-31b48557889b)

#### **使用對數轉換（Logarithms）**
為了平滑目標變數分佈，減少極端值帶來的影響，我們嘗試將「總價元」做對數轉換。

#### **地段重要性**
「香港首富李嘉誠曾說，房地產最重要的條件就是地段」，因此我們特別重視地理位置的資訊，並蒐集相關的地點變數。

#### **蒐集經緯度資料**
透過 Google Cloud Geocoding API 將地址轉換為經緯度座標。由於部分地址資料較雜亂，需要進行手動處理：

![Geocoding API](https://github.com/user-attachments/assets/9762d1f7-609c-4ec2-afa2-4fdc14638472)

- **空值處理**：遇到地籍或交叉路口而無法查詢時，需要由地籍圖資網路便民服務系統進行補查。
  
  ![地籍圖資](https://github.com/user-attachments/assets/266b75ab-93f2-4d8e-9071-0c1d4ebacbe3)

- **異常值處理**：手動更正或移除。

---

### 2. 建造特徵
#### **土地數量、建物數量、車位數量**
對原始資料中每筆交易的土地、建物與車位數進行分欄與整理，產生對應數量特徵。

#### **離群值處理**
嘗試移除離群值，但效果不佳，故暫時擱置。

---

### 3. 建造特徵：聚類
#### **KMeans 空間聚類**
使用 KMeans 演算法，對經緯度進行空間聚類分析，生成了 500 個聚類中心，並產生物件到各中心距離的特徵（k1 至 k500）。

![KMeans 聚類](https://github.com/user-attachments/assets/cc5f1d4e-bdf5-47a5-8a8a-049c7712c5ce)

#### **聚類內部統計**
計算各聚類內：
- 銷售數量
- 相同用途比例
- 建物類型比例
- 平均單價

以強化地段資訊的影響力。

---

### 4. 建造特徵：日期
#### **日期欄位標準化**
將「交易年月日」的民國年轉為西元年，並提取交易的年份、月份、季度等資訊。

#### **月份週期性處理**
對月份進行三角函數（sin、cos）編碼，以捕捉月份的週期性關係。

![月份轉換](https://github.com/user-attachments/assets/fb4b94f3-0f38-42ba-afe9-a97ca701915e)

#### **未來改善方向**
- 可藉由 **信義房價指數** (純住中古屋物件)、**國泰房價指數** (預售屋) 加權不同時期的房價基準。

  ![信義指數](https://github.com/user-attachments/assets/caa0ab9a-8179-44f6-adf1-65086c2a6601)
  ![國泰指數](https://github.com/user-attachments/assets/9048ea6e-a9ac-424d-a30e-c85f4e38d90e)

---

### 5. 建造特徵：樓層
#### **移轉層次數值化**
將「移轉層次」中文數字轉換為數值後，再判斷是否為頂樓 (`top_floor`)。

#### **樓層比例 (`floor_ratio`)**
計算物件所在樓層與建物總樓層數之比：
\[
\text{floor_ratio} = \frac{\text{物件所在樓層}}{\text{建物總樓層數}}
\]

---

### 6. 建造特徵：路名
- **VBA 萃取路名**
- **合併欄位**：「縣市鄉鎮市區 + 路名」，進一步細分地段資訊。

---

### 7. 輸出處理：價錢數值取整
#### **觀察成交價**
房價通常以 **萬** 為單位，因此我們在輸出最終預測時，將「總價元」四捨五入到萬位數。

---

### 8. 訓練
#### **平台**
- **Google Colab Pro**
- **T4 GPU 加速運算**

#### **模型比較**
- **CatBoost**
  - 直接支援類別特徵
  - BayesianOptimization 進行參數調整
  - 內建特徵選擇 (Feature Selection) 效果不佳，暫不使用。

- **XGBoost**
  - **KFold 交叉驗證**
  - **MAE 約 110,000**

---

### 9. **關鍵步驟：高度解釋力特徵**
經過深入觀察與地政司資料比對，我們發現：
- **「單價元平方公尺」 × 「建物移轉總面積平方公尺」 具有高度解釋力。**

  ![高解釋力特徵](https://github.com/user-attachments/assets/a7c8e55b-617a-440e-b073-b237757814b9)

  ![資料對應](https://github.com/user-attachments/assets/f731d1a1-bb66-49df-b059-ca03b60049c1)

#### **調整計算公式**
```math
\text{總價元} =
\begin{cases} 
(\text{建物移轉總面積平方公尺}) \times 5 \times (\text{單價元平方公尺}), & \text{若車位面積=0 且 車位總價元≠0} \\
(\text{建物移轉總面積平方公尺}) \times (\text{單價元平方公尺}) + \text{車位總價元}, & \text{若車位面積≠0 且 車位總價元=0} \\
(\text{建物移轉總面積平方公尺} - \text{車位移轉總面積平方公尺}) \times (\text{單價元平方公尺}) + \text{車位總價元}, & \text{其他}
\end{cases}
```
- 使用該公式後，部分情境下的 **MAE 降至約 5000**，顯示該特徵具有極高解釋力。

---

## **結論與展望**
### **結論**
透過：
- 地點、樓層、時間、空間聚類等多種特徵構建
- 使用 **XGBoost + KFold**
- 發現 **單價 × 建物面積** 高度解釋力

最終 **顯著提升預測表現**。

### **未來發展**
- **蒐集更多外部資料**：信義房價指數、國泰房價指數
- **更細緻的地點分析**：學區、捷運、生活機能
- **優化參數調整 & 嘗試新模型**：LightGBM、Neural Network

---

感謝閱讀 **Taiwan-Housing-Prediction** 報告，如有問題或建議，歡迎交流！ 🚀
